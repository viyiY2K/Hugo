---
title: 4.1 计算机网络 (Computer Networks)
description: 
toc: true
authors:
tags:
categories:
series:
date: '2022-10-02'
lastmod: '2023-09-17'
draft: false
---
### 4.1.1 早期网络

```timeline
[line-2, body-2]

+ 150 年前
+ 特快邮件
+ - 发一封信件从伦敦到加州要花 2~3 周。
- 传播一条信息所需要的时间称为「时延」 (latency) 。

+ 1950~60s
+ 球鞋网络 (sneakernet) 
+ - 在公司或研究室内部使用，旨在信息交换。
- 也有助于共享物理资源，如打印机或存储器。

+ 1970s
+ 以太网
+ - 一种局域网 (近距离构成的小型网络，简称 LAN) ，诞生于  Xerox PARC (施乐的"帕洛阿尔托研究中心") 。
- 最简单形式：一条以太网电线连接数台计算机，数据在电缆中共享，各取所需。

```

### 4.1.2 以太网

#### MAC 地址

以太网 (Ethernet) 是早期最著名也最成功的一种局域网 LAN 技术，其使用一条以太网电线连接数台计算机，数据在电缆中进行共享，使用 MAC 地址 (Media Access Control address) 来确认接收数据的对象。

![MAC 地址](https://zyin-1309341307.cos.ap-nanjing.myqcloud.com/note/1674649146505.png)

将 MAC 地址放在数据头部作为前缀，当计算机监听到以太电缆中的数据有自己的 MAC 地址时才处理数据。现在制造的每一台计算机都自带唯一的 MAC 地址用于构建以太网和无线网络 (WIFI) 。

#### 载波监听

像以太网这样多台电脑共享一个传输媒介的方法称为「载波侦听多路访问」 (Carrier Sense Multiple Access, CSMA)  ：

- 载体 (carrier)：指运输数据的共享媒介。以太网的"载体"是铜线，WiFi 的"载体"是传播无线电波的空气。
- 侦听(Sense)：计算机守候在端口等待数据。
- 多路访问 (Multiple Access)：许多计算机同时侦听载体。

载体传输数据的速度 叫「带宽」(Bandwidth)，共享载体会导致网络流量上升时出现「冲突」(collision)——大家都想往载体里传数据，但一次只能有一个。

出现冲突后最简单的处理方式是停止传输，等待网络空闲重试。但其他计算机也会这样做，这很可能导致更多冲突。

#### 指数退避

一台计算机在传输聚聚期间检测到冲突时，会等待“1s+随机时间”后重试。若重试仍然出现冲突，意味着网络出现拥塞 (congestion)，此时则等待 2s。再度重试仍然冲突时，等待 4s 后进行重发尝试。接着是 8s、16s etc. ，以此类推。

这种等待时间指数级增长的方法称为「指数退避」(Exponential Backoff)，以太网和 WIFI 等传输协议均使用这种技巧避免网络拥塞。

#### 冲突域

载体和其中的设备总称为「冲突域」(Collision Domain)，为了减少冲突并提升效率，可以将一个大的冲突域拆解为两个小的冲突域，使用交换机 (Network Switch) 来连接。

![冲突域](https://zyin-1309341307.cos.ap-nanjing.myqcloud.com/note/1674649311076.png)

交换机会维护记录着 MAC 地址所属网络（冲突域）的列表，其仅在必要时进行数据传输，如当 A 向 F 发数据时。

### 4.2.3 路由

大型网络的构建通常是由多个稍小的网络连接而成的，而一个计算机通过多个网络到达另一个计算机通常也会有多条路径，因此存在「路由」(routing) 问题。

#### 电路交换

如同早期 1910s 的电话系统那样，为两台遥遥相望的计算机或网络通过电路连接后分配一条专用的通信线路，称为「电路交换」(Circuit Switching)。

电路交换的缺点在于不灵活且价格高昂，同时存在线路闲置的情况。其优点在于专属电路无需共享可以随意使用，因此军队、银行等其他机构依然会购买专用线路来连接数据中心。

#### 报文交换

使用类似于邮政系统的站点中转方式进行数据传输，称为「报文交换」(Message Switching)。

在报文交换中，数据会经由不同的路由器 (network routers) 传输至目的地。消息沿着路由跳转的次数称为「跳数」(hop count)，通过对跳数的记录分析，可以分辨相应的路由问题。

若某条报文的跳数被检测出过高异常，则可以推断出路由存在错误，这称为「跳数限制」(Hop Limit)。

报文交换的优点在于可以使用不同的路由使得通信更为可靠、容错率更高。缺点在于报文较大时易堵塞网络，可通过将大报文拆分为「数据包」(packets) 来解决。

#### IP 协议

被分割出的数据包中均带有目标地址，用于告知路由器如何转发。报文的具体格式通过 1970s 创建的「互联网协议」(Internet Protocol, IP) 定义。

遵循 IP 协议的计算机都用于一个 IP 地址，以点分十进制的方式表示，如 172.217.7.238 (Google 某服务器的 IP 地址)。

数百万台计算机在网络上不断交换数据，瓶颈的出现和消失是毫秒级的。因此，路由器平衡会与其他路由器之间的负载，以确保网络中的数据传输可以快速可靠，这叫「阻塞控制」(congestion control)。

当同一报文的不同数据包经由不同线路到达目的地，其到达的先后顺序可能不一致，即出现乱序问题，可以通过 TCP/IP 协议来解决。

#### 分组交换

将大的报文数据拆分成多个小数据包后，通过灵活的路由传递，这种传输数据的运行方式称为「分组交换」(Packet Switching)。

分组交换源于冷战期间的核攻击威胁，具有去中心化的特点，不存在中心权威机构，也没有单点失败问题。

世界上第一个分组交换网络是 ARPANET ，该名字源于赞助此项目的机构“美国高级研究计划局”(Advanced Research Projects Agency)。

![1974 年的 ARPANET](https://zyin-1309341307.cos.ap-nanjing.myqcloud.com/note/1674650984942.png)

上图是 1974 年的 ARPANET 简图。图中每个小圆表示一个地点，比如运行着一个路由器的大学或实验室（拥有单台或多台计算机）。图中还能看到 "PDP-1" 和"IBM 360系统"，甚至还有一个伦敦的 ATLAS 是通过卫星连到网络里的。

如今，全球的路由器协同工作，找出最高效的线路，用各种标准协议运输数据，比如 "因特网控制消息协议"(Internet Control Message Protocol, ICMP) 以及"边界网关协议"(Border Gateway Protocol, BGP) 等。

互联网在这几十年间发展迅速，据估计约有接近 100 亿台联网设备。随着各种智能设备的出现，比如联网冰箱，恒温器以及其他智能家电，它们还组成了「物联网」(internet of things)。